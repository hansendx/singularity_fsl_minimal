Bootstrap: debootstrap
OSVersion: stable
MirrorURL: http://ftp.us.debian.org/debian/

%help

=====================================================
Neurodebian Container with fsl.5.0-complete installed
=====================================================

Every tool provided by fsl 5.0-complete
can be used through singularity exec:
    singularity exec imagename.simg toolname [tooloptions]


%post

# Install gnupg2, to add the neurodebian repository key
# wget, to load the neurodebian repository details
# eatmydata, to speed up fsl install
apt-get update
apt-get install gnupg2 wget eatmydata -y 

# Get the neurodebian repository details
wget -O- http://neuro.debian.net/lists/stretch.de-md.full | tee /etc/apt/sources.list.d/neurodebian.sources.list

# To catch bad/broken keyservers.
# Uses european serverpool.
# General pool is hkp://pool.sks-keyservers.net
while true; do
	apt-key adv --recv-keys --keyserver hkp://eu.pool.sks-keyservers.net:80 0xA5D32F012649A5A9 || continue
	break
done


# Install fsl
apt-get update 
eatmydata apt-get install fsl-5.0-complete -y

# Set the environmen, so fsl can be called directly 
# (Only takes effect after build)
cp /etc/fsl/5.0/fsl.sh /.singularity.d/env/90-environment.sh


# Cleanup things not needed in the finished container.
apt-get purge gnupg2 wget eatmydata -y
apt-get autoclean -y
apt-get autoremove -y
rm -rf /var/lib/apt/lists/*
